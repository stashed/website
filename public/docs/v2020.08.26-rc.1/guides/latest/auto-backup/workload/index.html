<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-62096468-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#5E2DEA"><title>Stash by AppsCode</title><meta name=description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta name=author content="AppsCode Inc."><meta name=keywords content="kubernetes appscode backup disaster recovery volume"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/stash/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/stash/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/stash/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/stash/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/stash/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/stash/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/stash/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/stash/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/stash/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/stash/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/stash/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/stash/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/stash/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/stash/icons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/images/products/stash/icons/ms-icon-144x144.png"><meta itemprop=name content="Stash by AppsCode"><meta itemprop=description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta itemprop=image content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeStash"><meta name=twitter:title content="Stash by AppsCode"><meta name=twitter:creator content="@KubeStash"><meta name=twitter:description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta name=twitter:image:src content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta property="og:url" content="https://stash.run"><meta property="og:title" content="Stash by AppsCode"><meta property="og:description" content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta property="og:site_name" content="Stash by AppsCode"><meta property="og:image" content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/css/font-awesome.min.css><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/keen-slider@latest/keen-slider.min.css><link rel=stylesheet href=/assets/sass/main.min.7c4a3c9b9b725ecf3969bcbc5840e69b185f0fac32d96a51f603a97a3293fcc7.css></head><body class=stash><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade Databases on Kubernetes</p></div></a><a href=https://stash.run class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://kubeform.com class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs & Terraform</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Open Source</a><div class=ac-megamenu><div class=columns><div class="column is-6"><div class=columns><div class="column is-12 br-1"><a href=https://voyagermesh.com class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-6"><div class=columns><div class="column is-12"><a href=https://pharmer.cloud class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm & Cluster API</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a></div></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://stash.run><img src=/assets/images/products/stash/stash-white.png alt=Stash></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/features/ class=navbar-item>Features</a>
<a href=/pricing/ class=navbar-item>Pricing</a>
<a href=/docs/v2020.12.17/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/stashed class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeStash class=navbar-item>Twitter</a>
<a href=https://slack.appscode.com class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=stars&query=%24.stars&url=https://github-stars.appscode.workers.dev/user/stashed">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="GitHub Forks" src="https://img.shields.io/badge/dynamic/json?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github&label=forks&query=%24.forks&url=https://github-stars.appscode.workers.dev/user/stashed">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/appscode/stash?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker&label=pulls"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start><a href=/docs/v2020.08.26-rc.1/ class=navbar-item>Welcome</a>
<a href=/docs/v2020.08.26-rc.1/concepts/ class=navbar-item>Concepts</a>
<a href=/docs/v2020.08.26-rc.1/setup/ class=navbar-item>Setup</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Guides</a><div class=ac-dropdown><a href=/docs/v2020.08.26-rc.1/guides/latest/ class=navbar-item>Latest Guides</a>
<a href=/docs/v2020.08.26-rc.1/guides/v1alpha1/ class=navbar-item>v1alpha1 Guides</a></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Addons</a><div class=ac-dropdown><a href=/docs/v2020.08.26-rc.1/addons/postgres/ class=navbar-item>Postgres</a>
<a href=/docs/v2020.08.26-rc.1/addons/elasticsearch/ class=navbar-item>Elasticsearch</a>
<a href=/docs/v2020.08.26-rc.1/addons/mysql/ class=navbar-item>MySQL</a>
<a href=/docs/v2020.08.26-rc.1/addons/mongodb/ class=navbar-item>MongoDB</a>
<a href=/docs/v2020.08.26-rc.1/addons/percona-xtradb/ class=navbar-item>Percona XtraDB</a></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Reference</a><div class=ac-dropdown><a href=/docs/v2020.08.26-rc.1/reference/operator/ class=navbar-item>Stash Operator</a>
<a href=/docs/v2020.08.26-rc.1/reference/cli/ class=navbar-item>Stash CLI</a></div></div></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v2020.12.17/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/stashed/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v2020.12.17/ class=dropdown-item>v2020.12.17<div class=tag>Latest</div></a><a href=/docs/v2020.11.17/ class=dropdown-item>v2020.11.17</a>
<a href=/docs/v2020.11.06/ class=dropdown-item>v2020.11.06</a>
<a href=/docs/v2020.10.30/ class=dropdown-item>v2020.10.30</a>
<a href=/docs/v2020.10.29/ class=dropdown-item>v2020.10.29</a>
<a href=/docs/v2020.10.21/ class=dropdown-item>v2020.10.21</a>
<a href=/docs/v2020.09.29/ class=dropdown-item>v2020.09.29</a>
<a href=/docs/v2020.09.16/ class=dropdown-item>v2020.09.16</a>
<a href=/docs/v2020.08.27/ class=dropdown-item>v2020.08.27</a>
<a href=/docs/v0.9.0-rc.6/ class=dropdown-item>v0.9.0-rc.6</a></div></div></div></div><div class=kd-sidebar-menu><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-1>
<label for=c4db149463f56e413b33509c0a2fe4bd-1><a href=/docs/v2020.08.26-rc.1/guides/latest/>Latest Guides</a></label></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-2>
<label for=c4db149463f56e413b33509c0a2fe4bd-2><a>Supported Backends</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/overview/>What is Backend?</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/local/>Kubernetes Volumes</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/s3/>AWS S3/Minio/Rook</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/azure/>Azure Blob Storage</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/gcs/>Google Cloud Storage</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/swift/>OpenStack Swift</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/b2/>Backblaze B2</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/backends/rest/>REST Server</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-3>
<label for=c4db149463f56e413b33509c0a2fe4bd-3><a>Workload's Volumes</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/workloads/overview/>How Backup and Restore works?</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/workloads/deployment/>Backup & Restore Volumes of a Deployment</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/workloads/statefulset/>Backup & Restore Volumes of a StatefulSet</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/workloads/daemonset/>Backup & Restore Volumes of a DaemonSet</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-4>
<label for=c4db149463f56e413b33509c0a2fe4bd-4><a>Stand-alone Volumes</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumes/overview/>How does it work?</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumes/pvc/>Backup & Restore a Stand-alone PVC</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-5>
<label for=c4db149463f56e413b33509c0a2fe4bd-5><a>Batch Backup</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/batch-backup/overview/>How Batch Backup & Restore works?</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/batch-backup/batch-backup/>Backup a WordPress Site</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-6 checked>
<label for=c4db149463f56e413b33509c0a2fe4bd-6><a>Auto Backup</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/auto-backup/overview/>What is Auto Backup?</a></li><li class=is-active><a href=/docs/v2020.08.26-rc.1/guides/latest/auto-backup/workload/>Auto Backup for Workloads</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/auto-backup/pvc/>Auto Backup for PVCs</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/auto-backup/database/>Auto Backup for Databases</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-7>
<label for=c4db149463f56e413b33509c0a2fe4bd-7><a>Volume Snapshot</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumesnapshot/overview/>How VolumeSnapshot works?</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumesnapshot/deployment/>Snapshot Deployment Volumes</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumesnapshot/statefulset/>Snapshot StatefulSet Volumes</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/volumesnapshot/pvc/>Snapshot Stand-alone PVC</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-8>
<label for=c4db149463f56e413b33509c0a2fe4bd-8><a>Advance Use Cases</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/advanced-use-case/instant-backup/>Instant Backup</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/advanced-use-case/pause-backup/>Pause Backup</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/advanced-use-case/clone-pvc/>Clone Data Volumes</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/advanced-use-case/ownership/>File Ownership</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-9>
<label for=c4db149463f56e413b33509c0a2fe4bd-9><a>Platforms</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/platforms/eks/>EKS</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/platforms/aks/>AKS</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/platforms/gke/>GKE</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/platforms/minio/>Minio</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/platforms/rook/>Rook</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-10>
<label for=c4db149463f56e413b33509c0a2fe4bd-10><a>Monitoring</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/monitoring/overview/>Overview</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/monitoring/builtin/>Builtin Prometheus</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/monitoring/coreos/>Prometheus Operator</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-11>
<label for=c4db149463f56e413b33509c0a2fe4bd-11><a>Addons</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/addons/overview/>Overview</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-12>
<label for=c4db149463f56e413b33509c0a2fe4bd-12><a>Hooks</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/hooks/overview/>Overview</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/hooks/backup-and-restore-hooks/>Backup & Restore Hooks</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/hooks/batch-backup-hooks/>BackupBatch Hooks</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/hooks/configuring-hooks/>Configuring Hooks</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-13>
<label for=c4db149463f56e413b33509c0a2fe4bd-13><a>CLI</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/cli/cli/>Stash kubectl Plugin</a></li></ul></div></div><div class=item><input type=checkbox id=c4db149463f56e413b33509c0a2fe4bd-14>
<label for=c4db149463f56e413b33509c0a2fe4bd-14><a>Security</a> <span><i class="fa fa-angle-right" aria-hidden=true></i></span></label><div class=item><ul><li><a href=/docs/v2020.08.26-rc.1/guides/latest/security/rbac/>RBAC</a></li><li><a href=/docs/v2020.08.26-rc.1/guides/latest/security/psp/>PSP</a></li></ul></div></div></div></div></div><div class="column is-7"><div class=full-info><article class="message is-warning"><div class=message-body>This is an Enterprise-only feature. Please install <a href=/docs/v2020.08.26-rc.1/setup/install/enterprise>Stash Enterprise Edition</a> to try this feature.</div></article><h1 id=auto-backup-for-workloads>Auto Backup for Workloads</h1><p>This tutorial will show you how to configure automatic backup for Kubernetes workloads. Here, we are going to show a demo on how we can backup Deployments, StatefulSets, and DaemonSets using a common blueprint.</p><h2 id=before-you-begin>Before You Begin</h2><ul><li><p>At first, you need to have a Kubernetes cluster, and the <code>kubectl</code> command-line tool must be configured to communicate with your cluster. If you do not already have a cluster, you can create one using <a href=https://kind.sigs.k8s.io/docs/user/quick-start/>kind</a>.</p></li><li><p>Install <code>Stash</code> in your cluster following the steps <a href=/docs/v2020.08.26-rc.1/setup/README>here</a>.</p></li><li><p>You should be familiar with the following Stash concepts:</p><ul><li><a href=/docs/v2020.08.26-rc.1/concepts/crds/repository>Repository</a></li><li><a href=/docs/v2020.08.26-rc.1/concepts/crds/backupconfiguration>BackupConfiguration</a></li><li><a href=/docs/v2020.08.26-rc.1/concepts/crds/backupblueprint>BackupBlueprint</a></li><li><a href=/docs/v2020.08.26-rc.1/concepts/crds/backupsession>BackupSession</a></li></ul></li></ul><p>To keep things isolated, we are going to use a separate namespace called <code>demo</code> throughout this tutorial.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl create namespace demo
namespace/demo created
</code></pre></div><h2 id=prepare-backup-blueprint>Prepare Backup Blueprint</h2><p>We are going to use <a href=/docs/v2020.08.26-rc.1/guides/latest/backends/gcs>GCS Backend</a> to store the backed up data. You can use any supported backend you prefer. You just have to configure Storage Secret and <code>spec.backend</code> section of <code>BackupBlueprint</code> to match your backend. To learn which backends are supported by Stash and how to configure them, please visit <a href=/docs/v2020.08.26-rc.1/guides/latest/backends/overview>here</a>.</p><blockquote><p>For GCS backend, if the bucket does not exist, Stash needs <code>Storage Object Admin</code> role permissions to create the bucket. For more details, please check the following <a href=/docs/v2020.08.26-rc.1/guides/latest/backends/gcs>guide</a>.</p></blockquote><p><strong>Create Storage Secret:</strong></p><p>At first, let&rsquo;s create a Storage Secret for the GCS backend,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ echo -n <span style=color:#e6db74>&#39;changeit&#39;</span> &gt; RESTIC_PASSWORD
$ echo -n <span style=color:#e6db74>&#39;&lt;your-project-id&gt;&#39;</span> &gt; GOOGLE_PROJECT_ID
$ mv downloaded-sa-json.key GOOGLE_SERVICE_ACCOUNT_JSON_KEY
$ kubectl create secret generic -n demo gcs-secret <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --from-file<span style=color:#f92672>=</span>./RESTIC_PASSWORD <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --from-file<span style=color:#f92672>=</span>./GOOGLE_PROJECT_ID <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --from-file<span style=color:#f92672>=</span>./GOOGLE_SERVICE_ACCOUNT_JSON_KEY
secret/gcs-secret created
</code></pre></div><p><strong>Create BackupBlueprint:</strong></p><p>Now, we have to create a <code>BackupBlueprint</code> crd with a blueprint for <code>Repository</code> and <code>BackupConfiguration</code> object.</p><p>Below is the YAML of the <code>BackupBlueprint</code> object that we are going to create,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BackupBlueprint</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>workload-backup-blueprint</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#75715e># ============== Blueprint for Repository ==========================</span>
  <span style=color:#f92672>backend</span>:
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>appscode-qa</span>
      <span style=color:#f92672>prefix</span>: <span style=color:#ae81ff>stash-backup/${TARGET_NAMESPACE}/${TARGET_KIND}/${TARGET_NAME}</span>
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
  <span style=color:#75715e># ============== Blueprint for BackupConfiguration =================</span>
  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#34;*/5 * * * *&#34;</span>
  <span style=color:#f92672>retentionPolicy</span>:
    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;keep-last-5&#39;</span>
    <span style=color:#f92672>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>Note that we have used some variables (format: <code>${&lt;variable name>}</code>) in <code>backend.gcs.prefix</code> field. Stash will substitute these variables with values from the respective target. Since the resolved prefix will be different for different workload, the backed up data will be stored in different directory inside the bucket. To know which variable you can use in this <code>prefix</code> field, please visit <a href=/docs/v2020.08.26-rc.1/concepts/crds/backupblueprint#repository-blueprint>here</a>.</p><p>Let&rsquo;s create the <code>BackupBlueprint</code> that we have shown above,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f https://github.com/stashed/docs/raw/v2020.08.26-rc.1/docs/examples/guides/latest/auto-backup/workload/backupblueprint.yaml
backupblueprint.stash.appscode.com/workload-backup-blueprint created
</code></pre></div><p>Now, automatic backup is configured for Kubernetes workloads (<code>Deployment</code>, <code>StatefulSet</code>, <code>DaemonSet</code> etc.). We just have to add some annotations to the targeted workload to enable periodic backup.</p><p><strong>Available Auto-Backup Annotations for Workloads:</strong></p><p>You have to add the auto-backup annotations to the workload that you want to backup. The following auto-backup annotations are available for a workload:</p><ul><li><strong>BackupBlueprint Name:</strong> You have to specify the <code>BackupBlueprint</code> name that holds the template for <code>Repository</code> and <code>BackupConfiguration</code> in the following annotation:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>stash.appscode.com/backup-blueprint</span>: <span style=color:#ae81ff>&lt;BackupBlueprint name&gt;</span>
</code></pre></div><ul><li><strong>Schedule:</strong> You can specify a schedule to backup this target through this annotation. If you don&rsquo;t specify this annotation, schedule from the <code>BackupBlueprint</code> will be used.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml> <span style=color:#f92672>stash.appscode.com/schedule</span>: <span style=color:#ae81ff>&lt;Cron Expression&gt;</span>
</code></pre></div><ul><li><strong>Target Paths:</strong> You have to specify a list of paths that you want to backup through this annotation. Use comma (<code>,</code>) to separate multiple file paths. For example, <code>"/my/target/dir-1,/my/target/dir-2"</code>.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>stash.appscode.com/target-paths</span>: <span style=color:#e6db74>&#34;&lt;paths to backup&gt;&#34;</span>
</code></pre></div><ul><li><strong>Volume Mounts:</strong> You have to also specify a list of Volumes and their MountPath and SubPath where the targeted paths are located. Use <code>"&lt;volumenName>:&lt;mountPath>:&lt;subPath>"</code> format to specify the volumes. The <code>:&lt;subPath></code> part is optional. Use comma (<code>,</code>) to specify multiple volumes and mount path. For example, <code>"vol-1:/mount/path-1:sub/path-1,vol-2:/mount/path-2"</code>.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>stash.appscode.com/volume-mounts</span>: <span style=color:#e6db74>&#34;&lt;volume&gt;:&lt;mountPath&gt;:&lt;subPath (optional)&gt;&#34;</span>
</code></pre></div><h2 id=backup-deployment>Backup Deployment</h2><p>Now, we are going to backup a Deployment using the blueprint we have configured earlier. We are going to mount two ConfigMap volume in two different directories of the Deployment. Then, we are going to backup those directories using automatic backup.</p><p><strong>Create Deployment:</strong></p><p>Below is the YAML of the Deployment and respective ConfigMaps that we are going to create,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-sample-data-1</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>data</span>:
  <span style=color:#f92672>file1.txt</span>: <span style=color:#e6db74>&#34;Data from ConfigMap &#39;stash-sample-data-1&#39;&#34;</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-sample-data-2</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>data</span>:
  <span style=color:#f92672>file2.txt</span>: <span style=color:#e6db74>&#34;Data from ConfigMap &#39;stash-sample-data-2&#39;&#34;</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>stash.appscode.com/backup-blueprint</span>: <span style=color:#ae81ff>workload-backup-blueprint</span>
    <span style=color:#f92672>stash.appscode.com/target-paths</span>: <span style=color:#e6db74>&#34;/source/data-1,/source/data-2&#34;</span>
    <span style=color:#f92672>stash.appscode.com/volume-mounts</span>: <span style=color:#e6db74>&#34;source-data-1:/source/data-1,source-data-2:/source/data-2&#34;</span>
    <span style=color:#f92672>stash.appscode.com/schedule</span>: <span style=color:#e6db74>&#34;*/15 * * * *&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>args</span>:
        - <span style=color:#ae81ff>sleep</span>
        - <span style=color:#e6db74>&#34;3600&#34;</span>
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>volumeMounts</span>:
        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-1</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-2</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-2</span>
      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
      <span style=color:#f92672>volumes</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
        <span style=color:#f92672>configMap</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-sample-data-1</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-2</span>
        <span style=color:#f92672>configMap</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-sample-data-2</span>
</code></pre></div><p>Notice the <code>metadata.annotations</code> field. We have specified the automatic backup specific annotations to backup <code>/source/data-1</code> and <code>/source/data-2</code> directories of the <code>source-data-1</code> and <code>source-data-2</code> volumes respectively. We have also specified to use <code>workload-backup-blueprint</code> BackupBlueprint for creating <code>Repository</code> and <code>BackupConfiguration</code> for this Deployment. BackupBlueprint is a non-namespaced resource, so we just need to specify the name of the blueprint.</p><p>Let&rsquo;s create the above Deployment,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f https://github.com/stashed/docs/raw/v2020.08.26-rc.1/docs/examples/guides/latest/auto-backup/workload/deployment.yaml
configmap/stash-sample-data-1 created
configmap/stash-sample-data-2 created
deployment.apps/stash-demo created
</code></pre></div><p>If everything goes well, Stash will create a <code>Repository</code> and a <code>BackupConfiguration</code> with the name in the following format: <code>&lt;workload-kind>-&lt;workload-name></code>.</p><p><strong>Verify Repository:</strong></p><p>Verify that the Repository has been created successfully by the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo                                                                9s
</code></pre></div><p>If we view the YAML of this Repository, we are going to see that the variables <code>${TARGET_NAMESPACE}</code>, <code>${TARGET_KIND}</code> and <code>${TARGET_NAME}</code> has been replaced by <code>demo</code>, <code>deployment</code> and <code>stash-demo</code> respectively.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo deployment-stash-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Repository</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deployment-stash-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>backend</span>:
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>appscode-qa</span>
      <span style=color:#f92672>prefix</span>: <span style=color:#ae81ff>stash-backup/demo/deployment/stash-demo</span>
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
</code></pre></div><p><strong>Verify BackupConfiguratoin:</strong></p><p>Verify that the <code>BackupConfiguration</code> has been created by the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE       PAUSED   AGE
deployment-stash-demo          */15 * * * *            19s
</code></pre></div><p>Let&rsquo;s check the YAML of this <code>BackupConfiguration</code>,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get backupconfiguration -n demo deployment-stash-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BackupConfiguration</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deployment-stash-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>repository</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deployment-stash-demo</span>
  <span style=color:#f92672>retentionPolicy</span>:
    <span style=color:#f92672>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>keep-last-5</span>
    <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>runtimeSettings</span>: {}
  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#39;*/15 * * * *&#39;</span>
  <span style=color:#f92672>target</span>:
    <span style=color:#f92672>paths</span>:
    - <span style=color:#ae81ff>/source/data-1</span>
    - <span style=color:#ae81ff>/source/data-2</span>
    <span style=color:#f92672>ref</span>:
      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>stash-demo</span>
    <span style=color:#f92672>volumeMounts</span>:
    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-1</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-2</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-2</span>
  <span style=color:#f92672>task</span>: {}
  <span style=color:#f92672>tempDir</span>: {}
</code></pre></div><p>Notice that the <code>spec.target.ref</code> is pointing to the <code>stash-demo</code> Deployment. Also, notice that the <code>spec.target.paths</code> and <code>spec.target.volumeMounts</code> fields have been populated with the information we had provided as annotation of the Deployment.</p><p><strong>Wait for BackupSession:</strong></p><p>Now, wait for the next backup schedule. Run the following command to watch <code>BackupSession</code> crd:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ watch -n <span style=color:#ae81ff>1</span> kubectl get backupsession -n demo -l<span style=color:#f92672>=</span>stash.appscode.com/backup-configuration<span style=color:#f92672>=</span>deployment-stash-demo

Every 1.0s: kubectl get backupsession -n demo                                   workstation: Wed Jun <span style=color:#ae81ff>26</span> 12:20:31 <span style=color:#ae81ff>2019</span>
NAME                               INVOKER-TYPE          INVOKER-NAME            PHASE       AGE
deployment-stash-demo-1561530008   BackupConfiguration   deployment-stash-demo   Succeeded   61s
</code></pre></div><blockquote><p>Note: Respective CronJob creates <code>BackupSession</code> crd with the following label <code>stash.appscode.com/backup-configuration=&lt;BackupConfiguration crd name></code>. We can use this label to watch only the <code>BackupSession</code> of our desired <code>BackupConfiguration</code>.</p></blockquote><p><strong>Verify Backup:</strong></p><p>When backup session is completed, Stash will update the respective <code>Repository</code> to reflect the latest state of backed up data.</p><p>Run the following command to check if the snapshots are stored in the backend,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo deployment-stash-demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo   true        <span style=color:#ae81ff>246</span> B   <span style=color:#ae81ff>2</span>                70s                      5m
</code></pre></div><blockquote><p>Stash creates one snapshot for each targeted file path. Since we are taking backup of two file paths, two snapshots have been created for this BackupSession.</p></blockquote><p>If we navigate to <code>stash-backup/demo/deployment/stash-demo</code> directory of our GCS bucket, we are going to see that the snapshot has been stored there.</p><figure align=center>  <img alt="Backup data in GCS backend" src=/docs/v2020.08.26-rc.1/images/guides/latest/auto-backup/workload/deployment_repo.png><figcaption align=center>Fig: Backup data in GCS backend</figcaption></figure><blockquote><p>Stash keeps all backup data encrypted. So, snapshot files in the bucket will not contain any meaningful data until they are decrypted.</p></blockquote><h2 id=backup-statefulset>Backup StatefulSet</h2><p>Now, we are going to backup a StatefulSet with the same blueprint we have used to backup Deployment in the previous section.</p><p><strong>Create StatefulSet:</strong></p><p>We are going to create a StatefulSet with 3 replicas. We are going to configure the StatefulSet to generate sample data in each replica.</p><p>Below is the YAML of the StatefulSet that we are going to create,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>headless</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>ports</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>0</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>clusterIP</span>: <span style=color:#ae81ff>None</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sts-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>stash.appscode.com/backup-blueprint</span>: <span style=color:#ae81ff>workload-backup-blueprint</span>
    <span style=color:#f92672>stash.appscode.com/target-paths</span>: <span style=color:#e6db74>&#34;/source/data-1,/source/data-2&#34;</span>
    <span style=color:#f92672>stash.appscode.com/volume-mounts</span>: <span style=color:#e6db74>&#34;source-data-1:/source/data-1,source-data-2:/source/data-2&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>headless</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;/bin/sh&#34;</span>, <span style=color:#e6db74>&#34;-c&#34;</span>]
        <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;touch /source/data-1/sample-file-1.txt &amp;&amp; touch /source/data-2/sample-file-2.txt &amp;&amp; sleep 3000&#34;</span>]
        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
        <span style=color:#f92672>volumeMounts</span>:
        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-1</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-2</span>
          <span style=color:#f92672>name</span>:  <span style=color:#ae81ff>source-data-2</span>
  <span style=color:#f92672>volumeClaimTemplates</span>:
  - <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>accessModes</span>: [ <span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span> ]
      <span style=color:#f92672>storageClassName</span>: <span style=color:#e6db74>&#34;standard&#34;</span>
      <span style=color:#f92672>resources</span>:
        <span style=color:#f92672>requests</span>:
          <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
  - <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-2</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>accessModes</span>: [ <span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span> ]
      <span style=color:#f92672>storageClassName</span>: <span style=color:#e6db74>&#34;standard&#34;</span>
      <span style=color:#f92672>resources</span>:
        <span style=color:#f92672>requests</span>:
          <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</code></pre></div><p>Notice the <code>metadata.annotations</code> field. We have specified automatic backup specific annotations similarly as we had specified in the Deployment in the previous section.</p><p>Let&rsquo;s create the StatefulSet we have created above,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f https://github.com/stashed/docs/raw/v2020.08.26-rc.1/docs/examples/guides/latest/auto-backup/workload/statefulset.yaml
service/headless created
statefulset.apps/sts-demo created
</code></pre></div><p><strong>Verify Repository:</strong></p><p>Verify that a Repository has been created for this StatefulSet using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
deployment-stash-demo   true        <span style=color:#ae81ff>410</span> B   <span style=color:#ae81ff>10</span>               14s                      39m
statefulset-sts-demo                                                                  31s
</code></pre></div><p>Here, <code>statefulset-sts-demo</code> Repository has been created for our <code>sts-demo</code> StatefulSet.</p><p>Let&rsquo;s view the YAML of the Repository,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo statefulset-sts-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Repository</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>statefulset-sts-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>backend</span>:
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>appscode-qa</span>
      <span style=color:#f92672>prefix</span>: <span style=color:#ae81ff>stash-backup/demo/statefulset/sts-demo</span>
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
</code></pre></div><p>Notice that the variables of the <code>prefix</code> field of <code>BackupBlueprint</code> is now replaced with <code>demo</code>, <code>statefulset</code> and <code>sts-demo</code> respectively.</p><p><strong>Verify BackupConfiguratoin:</strong></p><p>Verify that a <code>BackupConfiguration</code> has been created for this StatefulSet using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE      PAUSED   AGE
deployment-stash-demo          */5 * * * *            40m
statefulset-sts-demo           */5 * * * *            105s
</code></pre></div><p>Here, <code>statefulset-sts-demo</code> has been created for the StatefulSet <code>sts-demo</code>. You can check the YAML of this <code>BackupConfiguration</code> to see that the target field is pointing to this StatefulSet.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get backupconfiguration -n demo statefulset-sts-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BackupConfiguration</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>statefulset-sts-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>repository</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>statefulset-sts-demo</span>
  <span style=color:#f92672>retentionPolicy</span>:
    <span style=color:#f92672>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>keep-last-5</span>
    <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>runtimeSettings</span>: {}
  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#39;*/5 * * * *&#39;</span>
  <span style=color:#f92672>target</span>:
    <span style=color:#f92672>paths</span>:
    - <span style=color:#ae81ff>/source/data-1</span>
    - <span style=color:#ae81ff>/source/data-2</span>
    <span style=color:#f92672>ref</span>:
      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sts-demo</span>
    <span style=color:#f92672>volumeMounts</span>:
    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-1</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-1</span>
    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/source/data-2</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>source-data-2</span>
  <span style=color:#f92672>task</span>: {}
  <span style=color:#f92672>tempDir</span>: {}
</code></pre></div><p><strong>Wait for BackupSession:</strong></p><p>Now, wait for the next backup schedule. Watch the <code>BackupSession</code> of the BackupConfiguration <code>statefulset-sts-demo</code> using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ watch -n <span style=color:#ae81ff>1</span> kubectl get backupsession -n demo -l<span style=color:#f92672>=</span>stash.appscode.com/backup-configuration<span style=color:#f92672>=</span>statefulset-sts-demo
Every 1.0s: kubectl get backupsession -n demo -l<span style=color:#f92672>=</span>stash.appscode.com/backup-...  workstation: Wed Jun <span style=color:#ae81ff>26</span> 13:01:22 <span style=color:#ae81ff>2019</span>

NAME                              INVOKER-TYPE          INVOKER-NAME           PHASE       AGE
statefulset-sts-demo-1561532403   BackupConfiguration   statefulset-sts-demo   Succeeded   2m21s
</code></pre></div><p><strong>Verify Backup:</strong></p><p>Once the backup session is completed, verify that the <code>Repository</code> has been updated to reflect the backup using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo statefulset-sts-demo
NAME                   INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
statefulset-sts-demo   true        <span style=color:#ae81ff>0</span> B    <span style=color:#ae81ff>6</span>                32s                      7m29s
</code></pre></div><blockquote><p>For StatfulSet, Stash takes backup from every replica. Since we are using a StatefulSet with 3 replicas and we are taking backup of 2 file paths, total 6 snapshots have been created for this BackupSession.</p></blockquote><p>If we navigate to <code>stash-backup/demo/statefulset/sts-demo</code> directory of our GCS bucket, we are going to see that the snapshot been stored there.</p><figure align=center>  <img alt="Backup data of `sts-demo` StatefulSet in GCS backend" src=/docs/v2020.08.26-rc.1/images/guides/latest/auto-backup/workload/statefulset_repo.png><figcaption align=center>Fig: Backup data of StatefulSet "sts-demo" in GCS backend</figcaption></figure><h2 id=backup-daemonset>Backup DaemonSet</h2><p>Now, we are going to use the same blueprint to backup a DaemonSet. We are going to mount a ConfigMap in <code>/etc/config</code> directory. Then, we are going to backup this directory using automatic backup.</p><p><strong>Create DaemonSet:</strong></p><p>Below is the YAML of the DaemonSet that we are going to create,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-daemon-config</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
<span style=color:#f92672>data</span>:
  <span style=color:#f92672>config-file-1.txt</span>: <span style=color:#e6db74>&#34;This is first config file&#34;</span>
  <span style=color:#f92672>config-file-2.txt</span>: <span style=color:#e6db74>&#34;This is second config file&#34;</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dmn-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#f92672>annotations</span>:
    <span style=color:#f92672>stash.appscode.com/backup-blueprint</span>: <span style=color:#ae81ff>workload-backup-blueprint</span>
    <span style=color:#f92672>stash.appscode.com/target-paths</span>: <span style=color:#e6db74>&#34;/etc/config&#34;</span>
    <span style=color:#f92672>stash.appscode.com/volume-mounts</span>: <span style=color:#e6db74>&#34;dmn-config:/etc/config&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
  <span style=color:#f92672>template</span>:
    <span style=color:#f92672>metadata</span>:
      <span style=color:#f92672>labels</span>:
        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>stash-demo</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
    <span style=color:#f92672>spec</span>:
      <span style=color:#f92672>containers</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>args</span>:
        - <span style=color:#ae81ff>sleep</span>
        - <span style=color:#e6db74>&#34;3600&#34;</span>
        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
        <span style=color:#f92672>volumeMounts</span>:
        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/config</span>
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dmn-config</span>
      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
      <span style=color:#f92672>volumes</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dmn-config</span>
        <span style=color:#f92672>configMap</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-daemon-config</span>
</code></pre></div><p>Notice the <code>metadata.annotations</code> field. We have specified automatic backup specific annotations to backup our desired file path.</p><p>Let&rsquo;s create the DaemonSet we have shown above,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f https://github.com/stashed/docs/raw/v2020.08.26-rc.1/docs/examples/guides/latest/auto-backup/workload/daemonset.yaml
configmap/my-daemon-config created
daemonset.apps/dmn-demo created
</code></pre></div><p><strong>Verify Repository:</strong></p><p>Verify that a <code>Repository</code> has been created for this DaemonSet using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo
NAME                    INTEGRITY   SIZE    SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
daemonset-dmn-demo                                                                    28s
deployment-stash-demo   true        <span style=color:#ae81ff>410</span> B   <span style=color:#ae81ff>10</span>               6m3s                     70m
statefulset-sts-demo    true        <span style=color:#ae81ff>0</span> B     <span style=color:#ae81ff>26</span>               6m6s                     31m
</code></pre></div><p>Here, <code>daemonset-dmn-demo</code> Repository has been created for our <code>dmn-demo</code> DaemonSet.</p><p>Let&rsquo;s view the YAML of the Repository,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo daemonset-dmn-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Repository</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>daemonset-dmn-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>backend</span>:
    <span style=color:#f92672>gcs</span>:
      <span style=color:#f92672>bucket</span>: <span style=color:#ae81ff>appscode-qa</span>
      <span style=color:#f92672>prefix</span>: <span style=color:#ae81ff>stash-backup/demo/daemonset/dmn-demo</span>
    <span style=color:#f92672>storageSecretName</span>: <span style=color:#ae81ff>gcs-secret</span>
</code></pre></div><p><strong>Verify BackupConfiguratoin:</strong></p><p>Verify that a <code>BackupConfiguration</code> has been created for this DaemonSet using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$  kubectl get backupconfiguration -n demo
NAME                    TASK   SCHEDULE      PAUSED   AGE
daemonset-dmn-demo             */5 * * * *            90s
deployment-stash-demo          */5 * * * *            71m
statefulset-sts-demo           */5 * * * *            32m
</code></pre></div><p>Here, <code>daemonset-dmn-demo</code> has been created for the DaemonSet <code>dmn-demo</code>. You can check the YAML of this <code>BackupConfiguration</code> to see that the target field is pointing to this DaemonSet.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get backupconfiguration -n demo daemonset-dmn-demo -o yaml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stash.appscode.com/v1beta1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>BackupConfiguration</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>daemonset-dmn-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>demo</span>
  <span style=color:#ae81ff>...</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>repository</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>daemonset-dmn-demo</span>
  <span style=color:#f92672>retentionPolicy</span>:
    <span style=color:#f92672>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>keep-last-5</span>
    <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>runtimeSettings</span>: {}
  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#39;*/5 * * * *&#39;</span>
  <span style=color:#f92672>target</span>:
    <span style=color:#f92672>paths</span>:
    - <span style=color:#ae81ff>/etc/config</span>
    <span style=color:#f92672>ref</span>:
      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DaemonSet</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dmn-demo</span>
    <span style=color:#f92672>volumeMounts</span>:
    - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/config</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dmn-config</span>
  <span style=color:#f92672>task</span>: {}
  <span style=color:#f92672>tempDir</span>: {}
</code></pre></div><p><strong>Wait for BackupSession:</strong></p><p>Now, wait for the next backup schedule. Watch the <code>BackupSession</code> of the BackupConfiguration <code>daemonset-dmn-demo</code> using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ watch -n <span style=color:#ae81ff>1</span> kubectl get backupsession -n demo -l<span style=color:#f92672>=</span>stash.appscode.com/backup-configuration<span style=color:#f92672>=</span>daemonset-dmn-demo

Every 1.0s: kubectl get backupsession -n demo -l<span style=color:#f92672>=</span>stash.appscode.com/backup-...  workstation: Wed Jun <span style=color:#ae81ff>26</span> 13:30:14 <span style=color:#ae81ff>2019</span>

NAME                            INVOKER-TYPE          INVOKER-NAME         PHASE       AGE
daemonset-dmn-demo-1561534208   BackupConfiguration   daemonset-dmn-demo   Succeeded   45s
</code></pre></div><p><strong>Verify Backup:</strong></p><p>Once the backup session is completed, verify that the <code>Repository</code> has been updated to reflect the backup using the following command,</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get repository -n demo daemonset-dmn-demo
NAME                 INTEGRITY   SIZE   SNAPSHOT-COUNT   LAST-SUCCESSFUL-BACKUP   AGE
daemonset-dmn-demo   true        <span style=color:#ae81ff>51</span> B   <span style=color:#ae81ff>1</span>                5s                       4m27s
</code></pre></div><blockquote><p>For DaemonSet, Stash takes backup from every daemon pod running on different nodes. Since we are using a single node cluster (Minikube), only 1 snapshot has been created for this BackupSession.</p></blockquote><p>If we navigate to <code>stash-backup/demo/daemonset/dmn-demo</code> directory of our GCS bucket, we are going to see that the snapshot been stored there.</p><figure align=center>  <img alt="Backup data of `dmn-demo` DaemonSet in GCS backend" src=/docs/v2020.08.26-rc.1/images/guides/latest/auto-backup/workload/daemon_repo.png><figcaption align=center>Fig: Backup data of DaemonSet "dmn-demo" in GCS backend</figcaption></figure><h2 id=cleanup>Cleanup</h2><p>To cleanup the Kubernetes resources created by this tutorial, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl delete -n demo deployment/stash-demo
kubectl delete -n demo statefulset/sts-demo
kubectl delete -n demo daemonset/dmn-demo

kubectl delete -n demo repository --all
kubectl delete -n demo secret/gcs-secret
kubectl delete -n demo backupblueprint/workload-backup-blueprint
</code></pre></div><p>If you would like to uninstall Stash operator, please follow the steps <a href=/docs/v2020.08.26-rc.1/setup/README>here</a>.</p></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before You Begin</a></li><li><a href=#prepare-backup-blueprint>Prepare Backup Blueprint</a></li><li><a href=#backup-deployment>Backup Deployment</a></li><li><a href=#backup-statefulset>Backup StatefulSet</a></li><li><a href=#backup-daemonset>Backup DaemonSet</a></li><li><a href=#cleanup>Cleanup</a></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown");var kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active");})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><div class=improve-section-area><div class="container section"><div class=improve-bg-color><div class=columns><div class="column is-6"><a href=https://github.com/stashed/docs/edit/master/docs/guides/latest/auto-backup/workload.md/>Improve This Page</a></div></div></div></div></div><script type=text/javascript>var pageSize=5;var acSearch=document.querySelector("#acSearch");var bodyOverlay=document.querySelector(".overlay-bg");var sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block";sidebarSearch.style.right="0";document.getElementById("searchbox").focus();bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none";sidebarSearch.style.right="-80%";});});function encodeQueryData(data){var ret=[];for(var d in data)
ret.push(encodeURIComponent(d)+'='+encodeURIComponent(data[d]));return ret.join('&');}
document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(event){event.preventDefault();if(event.keyCode===13){queryPage(1);}});function queryPage(idx){var q=document.getElementById("searchbox").value;var cx="015199383701854252104:0pfqfvpvwyl";var key="AIzaSyBo15AW3hatf4fO8actJUZ_d5qZJpx0rXM";var imgSize="small";var callback="renderResult";var src="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:q,cx:cx,key:key,imgSize:imgSize,callback:callback,start:(idx-1)*pageSize+1,num:pageSize,});var newScript=document.createElement("script");newScript.src=src;e=document.getElementById("searchbar-script-container");var child=e.lastElementChild;if(child){e.removeChild(child);}
e.appendChild(newScript);}
function renderSearchResultEntry(e){var out='<div class="single-search-result">'+
'<h3><a href="'+e.link+'">'+e.title+'</a></h3>'+
'<a href="'+e.link+'">'+e.htmlFormattedUrl+'</a>'+
'<div class="result-description-wrapper">';if(e.pagemap&&e.pagemap.cse_thumbnail){out+='<div class="result-thumb">'+
'<img src="'+e.pagemap.cse_thumbnail[0].src+'" alt="" />'+
'</div>';}
out+='<div class="result-description">'+
'<p>'+
e.snippet+
'</p>'+
'</div>'+
'</div>'+
'</div>';return out;}
function renderResult(response){document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left">'+
'<p>'+
'About <span class="search-count">'+response.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+response.searchInformation.formattedSearchTime+' </span>seconds)'+
'</p>'+
'</div>';if(!response.items){return;}
var searchResultWrapper=document.querySelector(".search-result-wrapper");searchResultWrapper.innerHTML="";for(var i=0;i<response.items.length;i++){searchResultWrapper.innerHTML+=renderSearchResultEntry(response.items[i]);}
var pager='<ul>';if(response.queries.previousPage){var pageIndex=Math.floor(response.queries.previousPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Previous</a></li>';}
if(response.queries.request){var pageIndex=Math.floor(response.queries.request[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')" class="is-active">'+pageIndex+'</a></li>';}
if(response.queries.nextPage){var pageIndex=Math.floor(response.queries.nextPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Next</a></li>';}
pager+='</ul>';document.querySelector(".pagination-area .pagination-list").innerHTML=pager;}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class="columns is-mobile is-multiline"><div class="column is-full-mobile is-one-third-desktop is-one-third-widescreen is-one-third-tablet" data-aos=fade-up><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form action="https://appscode.us17.list-manage.com/subscribe/post?u=feb2bf31969a951e7449048a3&id=82fb19acb9" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input class=input name=EMAIL id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:+1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>+1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=500><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://stash.run>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href=https://kubeform.com>Kubeform</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=600><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Pricing</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=700><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=800><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>© 2021 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script src=https://unpkg.com/downloadjs@1.4.7/download.min.js></script><script src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><script src=/assets/js/main.js></script><script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date();(function(){var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];s1.async=true;s1.src='https://embed.tawk.to/5821e34b18d9f16af02864b7/default';s1.charset='UTF-8';s1.setAttribute('crossorigin','*');s0.parentNode.insertBefore(s1,s0);})();</script></body></html>