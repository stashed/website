<!doctype html><html lang=en><head><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-62096468-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#5E2DEA"><title>Stash by AppsCode</title><meta name=description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta name=author content="AppsCode Inc."><meta name=keywords content="kubernetes appscode backup disaster recovery volume"><link rel=apple-touch-icon sizes=57x57 href=/assets/images/products/stash/icons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/assets/images/products/stash/icons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/assets/images/products/stash/icons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/assets/images/products/stash/icons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/assets/images/products/stash/icons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/assets/images/products/stash/icons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/assets/images/products/stash/icons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/assets/images/products/stash/icons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/assets/images/products/stash/icons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/assets/images/products/stash/icons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/assets/images/products/stash/icons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/assets/images/products/stash/icons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/assets/images/products/stash/icons/favicon-16x16.png><link rel=manifest href=/assets/images/products/stash/icons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/images/products/stash/icons/ms-icon-144x144.png"><meta itemprop=name content="Stash by AppsCode"><meta itemprop=description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta itemprop=image content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeStash"><meta name=twitter:title content="Stash by AppsCode"><meta name=twitter:creator content="@KubeStash"><meta name=twitter:description content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta name=twitter:image:src content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta property="og:url" content="https://stash.run"><meta property="og:title" content="Stash by AppsCode"><meta property="og:description" content="Stash by AppsCode is a cloud native data backup and recovery solution for Kubernetes workloads, volumes and databases"><meta property="og:site_name" content="Stash by AppsCode"><meta property="og:image" content="https://stash.run/assets/images/products/stash/stash-1280x640.png"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/css/font-awesome.min.css><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><link rel=stylesheet href=/assets/css/bulma-carousel.min.css><link rel=stylesheet href=/assets/css/bulma-tooltip.min.css><link rel=stylesheet href=/assets/css/bulma.min.css><link rel=stylesheet href=/assets/sass/main.css></head><body class=stash><header><div class=header-top><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav1><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav1 class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Products</a><div class=ac-megamenu><div class=columns><div class="column is-8"><div class=columns><div class="column is-6 br-1"><a href=https://kubedb.com class="single-product-item is-kubedb"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubedb/kubedb-icon.png alt=KubeDB></div><h5>KubeDB</h5></div><div class=menu-body><p>Run production-grade databases easily on Kubernetes</p></div></a><a href=https://stash.run class="single-product-item is-stash"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/stash/stash-icon.png alt=Stash></div><h5>Stash</h5></div><div class=menu-body><p>Backup your Kubernetes Stateful Applications</p></div></a><a href=https://kubevault.com class="single-product-item is-kubevault"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubevault/kubevault-icon.png alt=KubeVault></div><h5>KubeVault</h5></div><div class=menu-body><p>Tools for running HashiCorp Vault on Kubernetes</p></div></a><a href=https://appscode.com/products/guard/ class="single-product-item is-guard"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/guard/guard-icon.png alt=Guard></div><h5>Guard</h5></div><div class=menu-body><p>Kubernetes Authentication WebHook Server</p></div></a></div><div class="column is-6 br-1"><a href class="single-product-item is-voyager"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/voyager/voyager-icon.png alt=Voyager></div><h5>Voyager</h5></div><div class=menu-body><p>Secure HAProxy Ingress Controller for
Kubernetes</p></div></a><a href=https://appscode.com/products/swift/ class="single-product-item is-swift"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/swift/swift-icon.png alt=Swift></div><h5>Swift</h5></div><div class=menu-body><p>Ajax friendly Helm Tiller Proxy</p></div></a><a href=https://appscode.com/products/searchlight/ class="single-product-item is-searchlight"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/searchlight/searchlight-icon.png alt=Searchlight></div><h5>Searchlight</h5></div><div class=menu-body><p>Alerts for Kubernetes</p></div></a><a href=https://appscode.com/products/kubed/ class="single-product-item is-kubed"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubed/kubed-icon.png alt=Kubed></div><h5>Kubed</h5></div><div class=menu-body><p>Kubernetes cluster manager daemon</p></div></a></div></div></div><div class="column is-4"><div class=columns><div class="column is-12"><a href=https://byte.builders class="single-product-item byte-builder kd-orange"><div class=menu-header><p class=intro>Introducing....</p><h5>ByteBuilders</h5></div><div class=menu-body><p>Cloud reimagined for the age of Kubernetes</p></div><p class=learn-more-btn>Learn more
<span class=icon><i class="fa fa-long-arrow-right" aria-hidden=true></i></span></p></a><a href=https://pharmer.io class="single-product-item is-pharmer"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/pharmer/pharmer-icon.png alt=Pharmer></div><h5>Pharmer</h5></div><div class=menu-body><p>Kubernetes Cluster Manager using Kubeadm & Cluster API</p></div></a><a href=https://kubeform.com class="single-product-item is-kubeform"><div class=menu-header><div class=menu-logo><img src=/assets/images/products/kubeform/kubeform-icon.png alt=Kubeform></div><h5>Kubeform</h5></div><div class=menu-body><p>Provision cloud resources using Kubernetes CRDs & Terraform</p></div></a></div></div></div></div><div class="columns has-text-centered"><div class=column><div class=menu-bottom><p>Explore apps and integrations for AppsCode products:
<a href=https://marketplace.byte.builders>Visit the Marketplace
<i class="fa fa-long-arrow-right" aria-hidden=true></i></a></p></div></div></div></div></div><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Services</a><div class=ac-dropdown><a class=navbar-item href=https://appscode.com/consulting/>Consulting</a>
<a class=navbar-item href=https://appscode.com/training/>Training</a>
<a class=navbar-item href=https://appscode.com/support/>Support</a></div></div><a class=navbar-item href=https://blog.byte.builders>Blog</a>
<a class=navbar-item href=https://appscode.com/contact/>Contact Us</a></div><div class=navbar-item><div class="buttons main-menu-button-top"><a class="button is-small for-chat" href=https://slack.appscode.com><span><img src=/assets/images/icon/slack.png alt></span>Slack</a>
<a class="button is-small for-support" href=https://appscode.freshdesk.com><span><img src=/assets/images/icon/chat.png alt></span>Support Portal</a></div></div></div></div></nav></div></div><div class="header-bottom-area header-area kubedb-primary-bg customize-kubedb fixed-menu"><div class="container section"><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://stash.run><img src=/assets/images/products/stash/stash-white.png alt=Stash></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=acNav class="navbar-menu main-menu"><div class=navbar-end><div class=navbar-start><a href=/features/ class=navbar-item>Features</a>
<a href=/pricing/ class=navbar-item>Pricing</a>
<a href=/docs/v2020.09.16/welcome/ class=navbar-item>Documentation</a><div class="navbar-item has-dropdown ac-is-hoverable"><a class=navbar-link>Community</a><div class=ac-dropdown><a href=https://github.com/stashed class=navbar-item>GitHub</a>
<a href=https://twitter.com/KubeStash class=navbar-item>Twitter</a>
<a href=https://slack.appscode.com class=navbar-item>Slack</a></div></div></div><div class=navbar-item><div class="buttons main-menu-button"><img style=height:24px alt="GitHub Stars" src="https://img.shields.io/github/stars/appscode/stash?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=github">
&nbsp;&nbsp;&nbsp;
<img style=height:24px alt="Docker Pulls" src="https://img.shields.io/docker/pulls/appscode/stash?style=flat&labelColor=1B3D4B&color=06A64F&logoColor=white&logo=docker"></div></div></div></div></nav></div></div><div class=documentation-menu><div class="container section"><div class=is-centered><div class="is-half has-text-centered-desktop"><div class=responsive-menu><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=acNav3><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><nav class=documentation-navbar><div id=acNav3 class="navbar-menu nav-menu main-menu"><div class=navbar-centered><div class=navbar-start></div></div></div></nav></div></div></div></div></header><div class=documentation-area><div class="container section"><div class=columns><div class="column is-3"><div class=kd-left-sidebar><div class=trial-button><a href=/docs/v2020.09.16/setup/ class="button is-fullwidth">Try Now for FREE!</a></div><div class=kd-version><div class=dropdown><div class=dropdown-trigger><button class="button is-fullwidth" aria-haspopup=true aria-controls=dropdown-menu3>
<span class="icon is-small"><i class="fa fa-angle-down" aria-hidden=true></i></span></button></div><div class=dropdown-menu id=dropdown-menu3 role=menu><div class=dropdown-content><a href=https://github.com/stashed/docs/tree/master/docs target=_blank class=dropdown-item>master</a>
<a href=/docs/v2020.09.16/ class=dropdown-item>v2020.09.16<div class=tag>Latest</div></a><a href=/docs/v2020.08.27/ class=dropdown-item>v2020.08.27</a>
<a href=/docs/v0.9.0-rc.6/ class=dropdown-item>v0.9.0-rc.6</a>
<a href=/docs/0.8.3/ class=dropdown-item>0.8.3</a>
<a href=/docs/0.8.2/ class=dropdown-item>0.8.2</a>
<a href=/docs/0.8.1/ class=dropdown-item>0.8.1</a>
<a href=/docs/0.8.0/ class=dropdown-item>0.8.0</a>
<a href=/docs/0.7.0/ class=dropdown-item>0.7.0</a>
<a href=/docs/0.6.4/ class=dropdown-item>0.6.4</a>
<a href=https://github.com/stashed/docs/tree/0.4.2/docs target=_blank class=dropdown-item>0.4.2</a></div></div></div></div><div class=kd-sidebar-menu></div></div></div><div class="column is-7"><div class=full-info><h1 id=stash-design-overview>Stash Design Overview</h1><p>We are going to make a design overhaul of Stash to simplify backup and recovery process and support some most requested features. This doc will discuss what features stash is going to support and how these features may work.</p><p>We have introduced some new crd such as <a href=#function>Function</a>, <a href=#action>Task</a> etc. and made whole process more modular. This will make easy to add support for new features and the users will also be able to customize backup process. Furthermore, this will make stash resources inter-operable between different tools and even might allow to use stash resources as function in serverless concept.</p><p><strong>We are hoping this design will graduate to GA. So, we are taking security seriously. We are going to make sure that nobody can bypass clusters security using Stash. This might requires to remove some existing features (for example, restore from different namespace). However, we are going to provide an alternate way to cover those use cases.</strong></p><h2 id=goal>Goal</h2><p>Goal of this new design to support following features:</p><ul><li><a href=#schedule-backup-and-restore-workload-data>Schedule Backup and Restore Workload Data</a></li><li><a href=#schedule-backup-and-restore-pvc>Schedule Backup and Restore PVC</a></li><li><a href=#schedule-backup-and-restore-database>Schedule Backup and Restore Database</a></li><li><a href=#schedule-backup-cluster-yamls>Schedule Backup Cluster YAMLs</a></li><li><a href=#trigger-backup-instantly>Trigger Backup Instantly</a></li><li><a href=#default-backup>Default Backup</a></li><li><a href=#auto-restore>Auto Restore</a></li><li><a href=#stash-clikubectl-plugin>Stash cli/kubectl-plugin</a></li><li><a href=#function>Function</a></li><li><a href=#task>Task</a></li></ul><h2 id=schedule-backup-and-restore-workload-data>Schedule Backup and Restore Workload Data</h2><h3 id=backup-workload-data>Backup Workload Data</h3><p>User will be able to backup data from a running workload.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>Repository</code> crd.</li><li>Create a <code>BackupConfiguration</code> crd pointing to targeted workload.</li></ul><p>Sample <code>Repository</code> crd:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1alpha2
<span style=color:#66d9ef>kind</span>: Repository
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>backend</span>:
    <span style=color:#66d9ef>gcs</span>:
      <span style=color:#66d9ef>bucket</span>: stash-backup-repo
      <span style=color:#66d9ef>prefix</span>: default/deployment/stash-demo
    <span style=color:#66d9ef>storageSecretName</span>: gcs-secret
</code></pre></div><p>Sample <code>BackupConfiguration</code> crd:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupConfiguration
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: workload-data-backup
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#75715e># &lt;no backupProcedure required for sidecar model&gt;</span>
  <span style=color:#75715e># repository refers to the Repository crd that hold backend information</span>
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># target indicate the target workload that we want to backup</span>
  <span style=color:#66d9ef>target</span>:
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: apps/v1
      <span style=color:#66d9ef>kind</span>: Deployment
      <span style=color:#66d9ef>name</span>: stash-demo
    <span style=color:#75715e># directories indicates the directories inside the workload we want to backup</span>
    <span style=color:#66d9ef>directories</span>:
    - /source/data
  <span style=color:#75715e># retentionPolicies specify the policy to follow to clean old backup snapshots</span>
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>Stash will watch for <code>BackupCofiguration</code> crd. When it will find a <code>BackupConfiguration</code> crd, it will inject a <code>sidecar</code> container to the workload and start a <code>cron</code> for scheduled backup.</li><li>In each schedule, the <code>cron</code> will create <code>BackupSession</code> crd.</li><li>The <code>sidecar</code> container watches for <code>BackupSession</code> crd. If it finds one, it will take backup instantly and update <code>BackupSession</code> status accordingly.</li></ul><p>Sample <code>BackupSession</code> crd:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupSession
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: demo-volume-backup-session
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#75715e># backupConfiguration indicates the BackupConfiguration crd of respective target that we want to backup</span>
  <span style=color:#66d9ef>backupConfiguration</span>:
    <span style=color:#66d9ef>name</span>: backup-volume-demo
<span style=color:#66d9ef>status</span>:
  <span style=color:#66d9ef>observedGeneration</span>: <span style=color:#ae81ff>239844</span><span style=color:#75715e>#2</span>
  <span style=color:#66d9ef>phase</span>: Succeed
  <span style=color:#66d9ef>stats</span>:
  - <span style=color:#66d9ef>direcotry</span>: /source/data
    <span style=color:#66d9ef>snapshot</span>: 40dc1520
    <span style=color:#66d9ef>totalSize</span>: <span style=color:#ae81ff>1.720</span> GiB
    <span style=color:#66d9ef>uploaded</span>: <span style=color:#ae81ff>1.200</span> GiB <span style=color:#75715e># upload size can be smaller than original file size if there are some duplicate files</span>
    <span style=color:#66d9ef>fileStats</span>:
      <span style=color:#66d9ef>new</span>: <span style=color:#ae81ff>5307</span>
      <span style=color:#66d9ef>changed</span>: <span style=color:#ae81ff>0</span>
      <span style=color:#66d9ef>unmodified</span>: <span style=color:#ae81ff>0</span>
</code></pre></div><h3 id=restore-workload-data>Restore Workload Data</h3><p>User will be able to restore backed up data either into a separate volume or into the same workload from where the backup was taken. Here, is an example for recovering into same workload.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>RestoreSession</code> crd pointing <code>target</code> field to the workload.</li></ul><p>Sample <code>RestoreSession</code> crd to restore into same workload:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: RestoreSession
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: recovery-database-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#66d9ef>target</span>: <span style=color:#75715e># target indicates where the recovered data will be stored</span>
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: apps/v1
      <span style=color:#66d9ef>kind</span>: Deployment
      <span style=color:#66d9ef>name</span>: stash-demo
    <span style=color:#66d9ef>directories</span>: <span style=color:#75715e># indicates which directories will be recovered</span>
    - /source/data
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>When Stash will find a <code>RestoreSession</code> crd created to restore into a workload, it will inject a <code>init-container</code> to the targeted workload.</li><li>Then, it will restart the workload.</li><li>The <code>init-container</code> will restore data inside the workload.</li></ul><blockquote><p><strong>Warning:</strong> Restore in same workload require to restart the workload. So, there will be downtime of the workload.</p></blockquote><h2 id=schedule-backup-and-restore-pvc>Schedule Backup and Restore PVC</h2><h3 id=backup-pvc>Backup PVC</h3><p>User will be also able to backup stand-alone pvc. This is useful for <code>ReadOnlyMany</code> or <code>ReadWriteMany</code> type pvc.</p><p><strong>What user have to do?</strong></p><ul><li><p>Create a <code>Repository</code> crd for respective backend.</p></li><li><p>Create a <code>BackupConfiguration</code> crd pointing <code>target</code> field to the volume.</p></li></ul><p>Sample <code>BackupConfiguration</code> crd to backup a PVC:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupConfiguration
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: volume-backup-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#75715e># task indicates Task crd that specifies the steps to backup a volume.</span>
  <span style=color:#75715e># stash will create some default Task crd  while install to backup/restore various resources.</span>
  <span style=color:#75715e># user can also crate their own Task to customize backup/recovery</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: volumeBackup
  <span style=color:#75715e># repository refers to the Repository crd that hold backend information</span>
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># target indicate the target workload that we want to backup</span>
  <span style=color:#66d9ef>target</span>:
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: v1
      <span style=color:#66d9ef>kind</span>: PersistentVolumeClaim
      <span style=color:#66d9ef>name</span>: demo-pvc  
    <span style=color:#66d9ef>mountPath</span>: /source/data
  <span style=color:#75715e># retentionPolicies specify the policy to follow to clean old backup snapshots</span>
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p><strong>How it will work?</strong></p><ol><li>Stash will create a <code>CronJob</code> using information of respective <code>Task</code> crd specified by <code>task</code> field.</li><li>The <code>CronJob</code> will take periodic backup of the target volume.</li></ol><h3 id=restore-pvc>Restore PVC</h3><p>User will be able to restore backed up data into a volume.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>RestoreSession</code> crd pointing <code>target</code> field to the target volume where the recovered data will be stored.</li></ul><p>Sample <code>RestoreSession</code> crd to restore into a volume:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: RestoreSession
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: recovery-volume-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># task indicates Task crd that specifies steps to restore a volume</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: volumeRecovery
  <span style=color:#66d9ef>target</span>: <span style=color:#75715e># target indicates where the recovered data will be stored</span>
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: v1
      <span style=color:#66d9ef>kind</span>: PersistentVolumeClaim
      <span style=color:#66d9ef>name</span>: demo-pvc  
    <span style=color:#66d9ef>mountPath</span>: /source/data
    <span style=color:#66d9ef>directories</span>: <span style=color:#75715e># indicates which directories will be recovered</span>
    - /source/data
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>When Stash will find a <code>RestoreSession</code> crd created to restore into a volume, it will launch a Job to restore into that volume.</li><li>The recovery Job will restore and store recovered data to the specified volume.</li></ul><h2 id=schedule-backup-and-restore-database>Schedule Backup and Restore Database</h2><h3 id=backup-database>Backup Database</h3><p>User will be able to backup database using Stash.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>Repository</code> crd for respective backend.</li><li>Create an <code>AppBinding</code> crd which holds connection information for the database. If the database is deployed with <a href=https://kubedb.com/docs/0.9.0/welcome/>KubeDB</a>, <code>AppBinding</code> crd will be created automatically for each database.</li><li>Create a <code>BackupConfiguration</code> crd pointing to the <code>AppBinding</code> crd.</li></ul><p>Sample <code>AppBinding</code> crd:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: appcatalog.appscode.com/v1alpha1
<span style=color:#66d9ef>kind</span>: AppBinding
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: quick-postgres
  <span style=color:#66d9ef>namespace</span>: demo
  <span style=color:#66d9ef>labels</span>:
    <span style=color:#66d9ef>kubedb.com/kind</span>: Postgres
    <span style=color:#66d9ef>kubedb.com/name</span>: quick-postgres
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>clientConfig</span>:
    <span style=color:#66d9ef>insecureSkipTLSVerify</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#66d9ef>service</span>:
      <span style=color:#66d9ef>name</span>: quick-postgres
      <span style=color:#66d9ef>port</span>: <span style=color:#ae81ff>5432</span>
      <span style=color:#66d9ef>scheme</span>: <span style=color:#e6db74>&#34;http&#34;</span>
  <span style=color:#66d9ef>secret</span>:
    <span style=color:#66d9ef>name</span>: quick-postgres-auth
  <span style=color:#66d9ef>type</span>: kubedb.com/postgres
</code></pre></div><p>Sample <code>BackupConfiguration</code> crd for database backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupConfiguration
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: database-backup-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#75715e># task indicates Task crd that specifies the steps to backup postgres database</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>:   pgBackup
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>database</span>: my-postgres <span style=color:#75715e># specify this field if you want to backup a particular database.</span>
  <span style=color:#75715e># repository refers to the Repository crd that hold backend information</span>
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># target indicates the respective AppBinding crd for target database</span>
  <span style=color:#66d9ef>target</span>:
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: appcatalog.appscode.com/v1alpha1
      <span style=color:#66d9ef>kind</span>: AppBinding
      <span style=color:#66d9ef>name</span>: quick-postgres
  <span style=color:#75715e># retentionPolicies specify the policy to follow to clean old backup snapshots</span>
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>When Stash will see a <code>BackupConfiguration</code> crd for database backup, it will launch a <code>CronJob</code> to take periodic backup of this database.</li></ul><h3 id=restore-database>Restore Database</h3><p>User will be able to initialize a database from backed up snapshot.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>RestoreSession</code> crd with <code>target</code> field pointing to respective <code>AppBinding</code> crd of the target database.</li></ul><p>Sample <code>RestoreSession</code> crd to restore database:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: RestoreSession
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: database-recovery-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># task indicates Task crd that specifies the steps to restore Postgres database</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: pgRecovery
  <span style=color:#66d9ef>target</span>: <span style=color:#75715e># target indicates where to restore</span>
    <span style=color:#75715e># indicates the respective AppBinding crd for target database that we want to initialize from backup</span>
    <span style=color:#66d9ef>ref</span>:
      <span style=color:#66d9ef>apiVersion</span>: appcatalog.appscode.com/v1alpha1
      <span style=color:#66d9ef>kind</span>: AppBinding
      <span style=color:#66d9ef>name</span>: quick-postgres
</code></pre></div><p><strong>How it will work?:</strong></p><ul><li>Stash will launch a Job to restore the backed up database and initialize target with this recovered data.</li></ul><h2 id=schedule-backup-cluster-yamls>Schedule Backup Cluster YAMLs</h2><p>User will be able to backup yaml of the cluster resources. However, currently stash will not provide automatic restore cluster from the YAMLs. So, user will have to create them manually.</p><p>In future, Stash might be able to backup and restore not only YAMLs but also entire cluster.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>Repository</code> crd for respective backend.</li><li>Create a <code>BackupConfiguration</code> crd with <code>task</code> field point to a <code>Task</code> crd that backup cluster.</li></ul><p>Sample <code>BackupConfiguration</code> crd to backup YAMLs of cluster resources:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupConfiguration
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: cluster-backup-demo
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#75715e># task indicates Task crd that specifies the steps of backup cluster yamls</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: clusterBackup
  <span style=color:#75715e># repository refers to the Repository crd that hold backend information</span>
  <span style=color:#66d9ef>repository</span>:
    <span style=color:#66d9ef>name</span>: stash-backup-repo
  <span style=color:#75715e># &lt;no target required for cluster backup&gt;</span>
  <span style=color:#75715e># retentionPolicies specify the policy to follow to clean old backup snapshots</span>
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>Stash will launch a <code>CronJob</code> using informations of the <code>Task</code> crd specified through <code>task</code> filed.</li><li>The <code>CronJob</code> will take periodic backup of the cluster.</li></ul><h2 id=trigger-backup-instantly>Trigger Backup Instantly</h2><p>User will be able to trigger a scheduled backup instantly.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>BackupSession</code> crd pointing to the target <code>BackupConfiguration</code> crd.</li></ul><p>Sample <code>BackupSession</code> crd for triggering instant backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupSession
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: demo-volume-backup-session
  <span style=color:#66d9ef>namespace</span>: demo
<span style=color:#66d9ef>spec</span>:
  <span style=color:#75715e># backupConfiguration indicates the BackupConfiguration crd of respective target that we want to backup</span>
  <span style=color:#66d9ef>backupConfiguration</span>:
    <span style=color:#66d9ef>name</span>: volume-backup-demo
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>For scheduled backup through <code>sidecar</code> container, the <code>sidecar</code> container will take instant backup as it watches for <code>BackupSession</code> crd.</li><li>For scheduled backup through <code>CronJob</code>, Stash will launch another job to take instant backup of the target.</li></ul><h2 id=default-backup>Default Backup</h2><p>User will also be able to configure a <code>default</code> backup for the cluster. So, user will no longer need to create <code>Repository</code> and <code>BackupConfiguration</code> crd for every workload he want to backup. Instead, she will need to add some annotations to the target workload.</p><p><strong>What user have to do?</strong></p><ul><li>Create a <code>BackupTemplate</code> crd which will hold backend information and backup information.</li><li>Add some annotations to the target. If the target is a database then add the annotations to respective <code>AppBinding</code> crd.</li></ul><h3 id=default-backup-of-workload-data>Default Backup of Workload Data</h3><p>Sample <code>BackupTemplate</code> crd to backup workload data:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupTemplate
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: workload-data-backup-template
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>backend</span>:
    <span style=color:#66d9ef>gcs</span>:
      <span style=color:#66d9ef>bucket</span>: stash-backup-repo
      <span style=color:#66d9ef>prefix</span>: ${target.namespace}/${target.name} <span style=color:#75715e># this prefix template will be used to initialize repository in different directory in backend.</span>
    <span style=color:#66d9ef>storageSecretName</span>: gcs-secret <span style=color:#75715e># users must ensure this secret is present in respective namespace</span>
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#75715e># &lt; no task required &gt;</span>
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#39;keep-last-5&#39;</span>
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>Sample workload with annotations for default backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: apps/v1
<span style=color:#66d9ef>kind</span>: Deployment
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: stash-demo
  <span style=color:#66d9ef>namespace</span>: demo
  <span style=color:#66d9ef>labels</span>:
    <span style=color:#66d9ef>app</span>: stash-demo
  <span style=color:#75715e># if stash find bellow annotations, it will take backup of it.</span>
  <span style=color:#66d9ef>annotations</span>:
    <span style=color:#66d9ef>stash.appscode.com/backuptemplate</span>: <span style=color:#e6db74>&#34;workload-data-backup-template&#34;</span>
    <span style=color:#66d9ef>stash.appscode.com/targetDirectories</span>: <span style=color:#e6db74>&#34;[/source/data]&#34;</span>
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#66d9ef>selector</span>:
    <span style=color:#66d9ef>matchLabels</span>:
      <span style=color:#66d9ef>app</span>: stash-demo
  <span style=color:#66d9ef>template</span>:
    <span style=color:#66d9ef>metadata</span>:
      <span style=color:#66d9ef>labels</span>:
        <span style=color:#66d9ef>app</span>: stash-demo
      <span style=color:#66d9ef>name</span>: busybox
    <span style=color:#66d9ef>spec</span>:
      <span style=color:#66d9ef>containers</span>:
      - <span style=color:#66d9ef>args</span>:
        - sleep
        - <span style=color:#e6db74>&#34;3600&#34;</span>
        <span style=color:#66d9ef>image</span>: busybox
        <span style=color:#66d9ef>imagePullPolicy</span>: IfNotPresent
        <span style=color:#66d9ef>name</span>: busybox
        <span style=color:#66d9ef>volumeMounts</span>:
        - <span style=color:#66d9ef>mountPath</span>: /source/data
          <span style=color:#66d9ef>name</span>: source-data
      <span style=color:#66d9ef>restartPolicy</span>: Always
      <span style=color:#66d9ef>volumes</span>:
      - <span style=color:#66d9ef>name</span>: source-data
        <span style=color:#66d9ef>configMap</span>:
          <span style=color:#66d9ef>name</span>: stash-sample-data
</code></pre></div><h3 id=default-backup-of-a-pvc>Default Backup of a PVC</h3><p>Sample <code>BackupTemplate</code> crd for stand-alone pvc backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupTemplate
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: volume-backup-template
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>backend</span>:
    <span style=color:#66d9ef>gcs</span>:
      <span style=color:#66d9ef>bucket</span>: stash-backup-repo
      <span style=color:#66d9ef>prefix</span>: ${target.namespace}/${target.name} <span style=color:#75715e># this prefix template will be used to initialize repository in different directory in backend.</span>
    <span style=color:#66d9ef>storageSecretName</span>: gcs-secret <span style=color:#75715e># users must ensure this secret is present in respective namespace</span>
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: volumeBackup
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#39;keep-last-5&#39;</span>
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>Sample PVC with annotation for default backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: v1
<span style=color:#66d9ef>kind</span>: PersistentVolumeClaim
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: demo-pvc
  <span style=color:#66d9ef>namespace</span>: demo
  <span style=color:#75715e># if stash find bellow annotations, it will take backup of it.</span>
  <span style=color:#66d9ef>annotations</span>:
    <span style=color:#66d9ef>stash.appscode.com/backuptemplate</span>: <span style=color:#e6db74>&#34;volume-backup-template&#34;</span>
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>accessModes</span>:
  - ReadWriteMany
  <span style=color:#66d9ef>resources</span>:
    <span style=color:#66d9ef>requests</span>:
      <span style=color:#66d9ef>storage</span>: 1Gi
</code></pre></div><h3 id=default-backup-of-database>Default Backup of Database</h3><p>Sample <code>BackupTemplate</code> crd for database backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: BackupTemplate
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: pgdb-backup-template
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>backend</span>:
    <span style=color:#66d9ef>gcs</span>:
      <span style=color:#66d9ef>bucket</span>: stash-backup-repo
      <span style=color:#66d9ef>prefix</span>: ${target.namespace}/${target.name} <span style=color:#75715e># this prefix template will be used to initialize repository in different directory in backend.</span>
    <span style=color:#66d9ef>storageSecretName</span>: gcs-secret <span style=color:#75715e># users must ensure this secret is present in respective namespace</span>
  <span style=color:#66d9ef>schedule</span>: <span style=color:#e6db74>&#39;@every 1h&#39;</span>
  <span style=color:#66d9ef>task</span>:
    <span style=color:#66d9ef>name</span>: pgBackup
  <span style=color:#66d9ef>retentionPolicy</span>:
    <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#39;keep-last-5&#39;</span>
    <span style=color:#66d9ef>keepLast</span>: <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>prune</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>Sample <code>AppBinding</code> crd with annotations for default backup:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: appcatalog.appscode.com/v1alpha1
<span style=color:#66d9ef>kind</span>: AppBinding
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: quick-postgres
  <span style=color:#66d9ef>namespace</span>: demo
  <span style=color:#66d9ef>labels</span>:
    <span style=color:#66d9ef>kubedb.com/kind</span>: Postgres
    <span style=color:#66d9ef>kubedb.com/name</span>: quick-postgres
    <span style=color:#75715e># if stash find bellow annotations, it will take backup of it.</span>
    <span style=color:#66d9ef>annotations</span>:
      <span style=color:#66d9ef>stash.appscode.com/backuptemplate</span>: <span style=color:#e6db74>&#34;pgdb-backup-template&#34;</span>
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>clientConfig</span>:
    <span style=color:#66d9ef>insecureSkipTLSVerify</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#66d9ef>service</span>:
      <span style=color:#66d9ef>name</span>: quick-postgres
      <span style=color:#66d9ef>port</span>: <span style=color:#ae81ff>5432</span>
      <span style=color:#66d9ef>scheme</span>: <span style=color:#e6db74>&#34;http&#34;</span>
  <span style=color:#66d9ef>secret</span>:
    <span style=color:#66d9ef>name</span>: quick-postgres-auth
  <span style=color:#66d9ef>type</span>: kubedb.com/postgres
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>Stash will watch the workloads, volume and <code>AppBinding</code> crds. When Stash will find an workload/volume/AppBinding crd with these annotations, it will create a <code>Repository</code> crd and a <code>BackupConfiguration</code> crd using the information from respective <code>Task</code>.</li><li>Then, Stash will take normal backup as discussed earlier.</li></ul><h2 id=auto-restore>Auto Restore</h2><p>User will be also able to configure an automatic recovery for a particular workload. Each time the workload restart, at first it will perform restore data from backup then original workload&rsquo;s container will start.</p><p><strong>What user have to do?</strong></p><ul><li>User will have to provide some annotations in the workload.</li></ul><p>Sample workload wit annotation to restore on restart:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>apiVersion</span>: apps/v1
<span style=color:#66d9ef>kind</span>: Deployment
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: stash-demo
  <span style=color:#66d9ef>namespace</span>: demo
  <span style=color:#66d9ef>labels</span>:
    <span style=color:#66d9ef>app</span>: stash-demo
  <span style=color:#75715e># This annotations indicates that data shoul be recovered on each restart of the workload</span>
  <span style=color:#66d9ef>annotations</span>:
    <span style=color:#66d9ef>stash.appscode.com/restorepolicy</span>: <span style=color:#e6db74>&#34;OnRestart&#34;</span>
    <span style=color:#66d9ef>stash.appscode.com/repository</span>: <span style=color:#e6db74>&#34;demo-backup-repo&#34;</span>
    <span style=color:#66d9ef>stash.appscode.com/directories</span>: <span style=color:#e6db74>&#34;[/source/data]&#34;</span>
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#66d9ef>selector</span>:
    <span style=color:#66d9ef>matchLabels</span>:
      <span style=color:#66d9ef>app</span>: stash-demo
  <span style=color:#66d9ef>template</span>:
    <span style=color:#66d9ef>metadata</span>:
      <span style=color:#66d9ef>labels</span>:
        <span style=color:#66d9ef>app</span>: stash-demo
      <span style=color:#66d9ef>name</span>: busybox
    <span style=color:#66d9ef>spec</span>:
      <span style=color:#66d9ef>containers</span>:
      - <span style=color:#66d9ef>args</span>:
        - sleep
        - <span style=color:#e6db74>&#34;3600&#34;</span>
        <span style=color:#66d9ef>image</span>: busybox
        <span style=color:#66d9ef>imagePullPolicy</span>: IfNotPresent
        <span style=color:#66d9ef>name</span>: busybox
        <span style=color:#66d9ef>volumeMounts</span>:
        - <span style=color:#66d9ef>mountPath</span>: /source/data
          <span style=color:#66d9ef>name</span>: source-data
      <span style=color:#66d9ef>restartPolicy</span>: Always
      <span style=color:#66d9ef>volumes</span>:
      - <span style=color:#66d9ef>name</span>: source-data
        <span style=color:#66d9ef>configMap</span>:
          <span style=color:#66d9ef>name</span>: stash-sample-data
</code></pre></div><p><strong>How it will work?</strong></p><ul><li>When Stash will see a <code>RestoreSession</code> crd configured for auto recovery, it will inject an <code>init-container</code> to the target.</li><li>The <code>init-container</code> will perform recovery on each restart.</li></ul><h2 id=stash-clikubectl-plugin>Stash cli/kubectl-plugin</h2><p>We are going to provide a Stash plugin for <code>kubectl</code>. This will help to perform following operations:</p><ul><li>Restore into local machine instead of cluster (necessary for testing purpose).</li><li>Restore into a different namespace from a repository: copy repository + secret into the desired namespace and then create <code>RestoreSession</code> object.</li><li>Backup PV: creates matching PVC from PV (ensures that user has permission to read PV)</li><li>Trigger instant backup.</li></ul><h2 id=function>Function</h2><p><code>Function</code> are independent single-containered workload specification that perform only single task. For example, <a href=#pgbackup>pgBackup</a> takes backup a PostgreSQL database and <a href=#clusterbackup>clusterBackup</a> takes backup of YAMLs of cluster resources. <code>Function</code> crd has some variable fields with <code>$</code> prefix which hast be resolved while creating respective workload. You can consider these variable fields as input for an <code>Function</code>.</p><p>Some example <code>Function</code> definition is given below:</p><h4 id=clusterbackup>clusterBackup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># clusterBackup function backup yamls of all resources of the cluster</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Function
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: clusterBackup
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>image</span>:  appscodeci/cluster-tool:v1
  <span style=color:#66d9ef>name</span>:  cluster-tool
  <span style=color:#66d9ef>args</span>:
  - backup
  - --sanitize=${sanitize}
  - --provider=${provider}
  - --hostname=${hostname}
  - --path=${repoDir}
  - --output-dir=${outputDir}
  - --retention-policy.policy=${policy}
  - --retention-policy.value=${retentionValue}
  - --metrics.enabled=${enableMetric}
  - --metrics.pushgateway-url=${pushgatewayURL}
  - --metrics.labels=<span style=color:#e6db74>&#34;workload-kind=${workloadKind},workload-name=${workloadName}&#34;</span>
  <span style=color:#66d9ef>volumeMounts</span>:
  - <span style=color:#66d9ef>name</span>: ${tempVolumeName}
    <span style=color:#66d9ef>mountPath</span>: /tmp/restic
  - <span style=color:#66d9ef>name</span>: ${storageSecretName}
    <span style=color:#66d9ef>mountPath</span>: /etc/secrets/storage-secret
</code></pre></div><h4 id=pgbackup>pgBackup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># pgBackup function backup a PostgreSQL database</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Function
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: pgBackup
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>image</span>:  appscodeci/postgresql-tool:v1
  <span style=color:#66d9ef>name</span>:  postgres-tool
  <span style=color:#66d9ef>args</span>:
  - backup
  - --database=${databases}
  - --provider=${provider}
  - --hostname=${hostname}
  - --path=${repoDir}
  - --output-dir=${outputDir}
  - --retention-policy.policy=${policy}
  - --retention-policy.value=${retentionValue}
  - --metrics.enabled=${enableMetric}
  - --metrics.pushgateway-url=${pushgatewayURL}
  - --metrics.labels=<span style=color:#e6db74>&#34;workload-kind=${workloadKind},workload-name=${workloadName}&#34;</span>
  <span style=color:#66d9ef>runtimeSettings</span>:
    <span style=color:#66d9ef>env</span>:
    - <span style=color:#66d9ef>name</span>:  PGPASSWORD
      <span style=color:#66d9ef>valueFrom</span>:
        <span style=color:#66d9ef>secretKeyRef</span>:
          <span style=color:#66d9ef>name</span>: $(databaseSecret)
          <span style=color:#66d9ef>key</span>: <span style=color:#e6db74>&#34;POSTGRES_PASSWORD&#34;</span>
    - <span style=color:#66d9ef>name</span>:  DB_USER
      <span style=color:#66d9ef>valueFrom</span>:
        <span style=color:#66d9ef>secretKeyRef</span>:
          <span style=color:#66d9ef>name</span>: $(databaseSecret)
          <span style=color:#66d9ef>key</span>: <span style=color:#e6db74>&#34;POSTGRES_USER&#34;</span>
    - <span style=color:#66d9ef>name</span>:  DB_HOST
      <span style=color:#66d9ef>value</span>: $(host)
  <span style=color:#66d9ef>volumeMounts</span>:
  - <span style=color:#66d9ef>name</span>: ${tempVolumeName}
    <span style=color:#66d9ef>mountPath</span>: /tmp/restic
  - <span style=color:#66d9ef>name</span>: ${storageSecretName}
    <span style=color:#66d9ef>mountPath</span>: /etc/secrets/storage-secret

</code></pre></div><h4 id=pgrecovery>pgRecovery</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># pgRecovery function restore a PostgreSQL database</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Function
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: pgRecovery
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>image</span>:  appscodeci/postgresql-tool:v1
  <span style=color:#66d9ef>name</span>:  postgres-tool
  <span style=color:#66d9ef>args</span>:
  - restore
  - --provider=${provider}
  - --hostname=${hostname}
  - --path=${repoDir}
  - --output-dir=${outputDir}
  - --metrics.enabled=${enableMetric}
  - --metrics.pushgateway-url=${pushgatewayURL}
  - --metrics.labels=<span style=color:#e6db74>&#34;workload-kind=${workloadKind},workload-name=${workloadName}&#34;</span>
  <span style=color:#66d9ef>runtimeSettings</span>:
    <span style=color:#66d9ef>env</span>:
    - <span style=color:#66d9ef>name</span>:  PGPASSWORD
      <span style=color:#66d9ef>valueFrom</span>:
        <span style=color:#66d9ef>secretKeyRef</span>:
          <span style=color:#66d9ef>name</span>: $(databaseSecret)
          <span style=color:#66d9ef>key</span>: <span style=color:#e6db74>&#34;POSTGRES_PASSWORD&#34;</span>
    - <span style=color:#66d9ef>name</span>:  DB_USER
      <span style=color:#66d9ef>valueFrom</span>:
        <span style=color:#66d9ef>secretKeyRef</span>:
          <span style=color:#66d9ef>name</span>: $(databaseSecret)
          <span style=color:#66d9ef>key</span>: <span style=color:#e6db74>&#34;POSTGRES_USER&#34;</span>
    - <span style=color:#66d9ef>name</span>:  DB_HOST
      <span style=color:#66d9ef>value</span>: $(host)
  <span style=color:#66d9ef>volumeMounts</span>:
  - <span style=color:#66d9ef>name</span>: ${tempVolumeName}
    <span style=color:#66d9ef>mountPath</span>: /tmp/restic
  - <span style=color:#66d9ef>name</span>: ${storageSecretName}
      <span style=color:#66d9ef>mountPath</span>: /etc/secrets/storage-secret
</code></pre></div><h4 id=stashpostbackup>stashPostBackup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># stashPostBackup update Repository and BackupSession status for respective backup</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Function
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: stashPostBackup
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>image</span>: appscode/stash:<span style=color:#ae81ff>0.9.0</span>
  <span style=color:#66d9ef>name</span>:  stash-post-backup
  <span style=color:#66d9ef>args</span>:
  - post-backup-update
  - --repository=${repoName}
  - --backupsession=${backupSessionName}
  - --output-json-dir=${outputJsonDir}
  <span style=color:#66d9ef>volumeMounts</span>:
  - <span style=color:#66d9ef>name</span>: ${outputVolumeName}
    <span style=color:#66d9ef>mountPath</span>: /tmp/restic
</code></pre></div><h2 id=stashpostrecovery>stashPostRecovery</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># stashPostRecovery update RestoreSession status for respective recovery</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Function
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: stashPostRecovery
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>image</span>: appscode/stash:<span style=color:#ae81ff>0.9.0</span>
  <span style=color:#66d9ef>name</span>:  stash-post-recovery
  <span style=color:#66d9ef>args</span>:
  - post-recovery-update
  - --recoveryconfiguration=${recoveryConfigurationName}
  - --output-json-dir=${outputJsonDir}
  <span style=color:#66d9ef>volumeMounts</span>:
  - <span style=color:#66d9ef>name</span>: ${outputVolumeName}
    <span style=color:#66d9ef>mountPath</span>: /tmp/restic
</code></pre></div><h2 id=task>Task</h2><p>A complete backup process may need to perform multiple function. For example, if you want to backup a PostgreSQL database, we need to initialize a <code>Repository</code>, then backup the database and finally update <code>Repository</code> and <code>BackupSession</code> status to inform backup is completed or push backup metrics to a <code>pushgateway</code> . <code>Task</code> specifies these functions sequentially along with their inputs.</p><p>We have chosen to break complete backup process into several independent steps so that those individual functions can be used with other tool than Stash. It also make easy to add support for new feature. For example, to add support new database backup, we are going to just require to add a <code>Function</code> and <code>Task</code> crd. We are going to no longer need change anything in Stash operator code. This will also helps users to backup databases that are not officially supported by stash.</p><p>Some sample <code>Task</code> is given below:</p><h4 id=pgbackup-1>pgBackup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># pgBackup specifies required functions and their inputs to backup PostgreSQL database</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Task
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: pgBackup
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>functions</span>:
  - <span style=color:#66d9ef>name</span>: pgBackup
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>database</span>: ${databases}
      <span style=color:#66d9ef>provider</span>: ${provider}
      <span style=color:#66d9ef>hostname</span>: ${hostname}
      <span style=color:#66d9ef>repoDir</span>: ${prefix}
      <span style=color:#66d9ef>outputDir</span>: ${outputDir}
      <span style=color:#66d9ef>policy</span>: ${retentionPolicyName}
      <span style=color:#66d9ef>retentionValue</span>: ${retentionPolicyValue}
      <span style=color:#66d9ef>enableMetric</span>: ${enableMetric}
      <span style=color:#66d9ef>pushgatewayURL</span>: ${pushgatewayURL}
      <span style=color:#66d9ef>workloadKind</span>: ${kind}
      <span style=color:#66d9ef>workloadName</span>: ${name}
      <span style=color:#66d9ef>tempVolumeName</span>: ${tmpVolumeName}
      <span style=color:#66d9ef>storageSecretName</span>: ${secretName}
  - <span style=color:#66d9ef>name</span>: stashPostBackup
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>repoName</span>: ${repoName}
      <span style=color:#66d9ef>backupSession</span>: ${backupSessionName}
      <span style=color:#66d9ef>outputJsonDir</span>: ${output-dir}
      <span style=color:#66d9ef>outputVolumeName</span>: ${output-volume-name}
</code></pre></div><h4 id=pgrecovery-1>pgRecovery</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># pgRecovery specifies required functions and their inputs to restore PostgreSQL database</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Task
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: pgRecovery
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>functions</span>:
  - <span style=color:#66d9ef>name</span>: pgRecovery
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>provider</span>: ${provider}
      <span style=color:#66d9ef>hostname</span>: ${hostname}
      <span style=color:#66d9ef>repoDir</span>: ${prefix}
      <span style=color:#66d9ef>outputDir</span>: ${outputDir}
      <span style=color:#66d9ef>enableMetric</span>: ${enableMetric}
      <span style=color:#66d9ef>pushgatewayURL</span>: ${pushgatewayURL}
      <span style=color:#66d9ef>workloadKind</span>: ${kind}
      <span style=color:#66d9ef>workloadName</span>: ${name}
      <span style=color:#66d9ef>tempVolumeName</span>: ${tmpVolumeName}
      <span style=color:#66d9ef>storageSecretName</span>: ${secretName}
  - <span style=color:#66d9ef>name</span>: stashPostRecovery
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>recoveryConfigurationName</span>: ${recoveryConfigurationName}
      <span style=color:#66d9ef>outputJsonDir</span>: ${output-dir}
      <span style=color:#66d9ef>outputVolumeName</span>: ${output-volume-name}
</code></pre></div><h4 id=clusterbackup-1>clusterBackup</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># clusterBackup specifies required functions and their inputs to backup cluster yaml</span>
<span style=color:#66d9ef>apiVersion</span>: stash.appscode.com/v1beta1
<span style=color:#66d9ef>kind</span>: Task
<span style=color:#66d9ef>metadata</span>:
  <span style=color:#66d9ef>name</span>: clusterBackup
<span style=color:#66d9ef>spec</span>:
  <span style=color:#66d9ef>functions</span>:
  - <span style=color:#66d9ef>name</span>: clusterBackup
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>sanitize</span>: ${sanitize}
      <span style=color:#66d9ef>provider</span>: ${provider}
      <span style=color:#66d9ef>hostname</span>: ${hostname}
      <span style=color:#66d9ef>repoDir</span>: ${prefix}
      <span style=color:#66d9ef>outputDir</span>: ${outputDir}
      <span style=color:#66d9ef>policy</span>: ${retentionPolicyName}
      <span style=color:#66d9ef>retentionValue</span>: ${retentionPolicyValue}
      <span style=color:#66d9ef>enableMetric</span>: ${enableMetric}
      <span style=color:#66d9ef>pushgatewayURL</span>: ${pushgatewayURL}
      <span style=color:#66d9ef>workloadKind</span>: ${kind}
      <span style=color:#66d9ef>workloadName</span>: ${name}
      <span style=color:#66d9ef>tempVolumeName</span>: ${tmpVolumeName}
      <span style=color:#66d9ef>storageSecretName</span>: ${secretName}
  - <span style=color:#66d9ef>name</span>: stashPostBackup
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>repoName</span>: ${repoName}
      <span style=color:#66d9ef>backupSession</span>: ${backupSessionName}
      <span style=color:#66d9ef>outputJsonDir</span>: ${output-dir}
      <span style=color:#66d9ef>outputVolumeName</span>: ${output-volume-name}
</code></pre></div></div></div><div class="column is-2"><div class=right-sidebar-area><div class=search-area><form action=#><input id=acSearch type=text placeholder=Search...>
<button class=search-button>
<i class="fa fa-search" aria-hidden=true></i></button></form></div><div class=tbl-of-contents><h4>What's on this Page</h4><nav id=TableOfContents><ul><li><a href=#goal>Goal</a></li><li><a href=#schedule-backup-and-restore-workload-data>Schedule Backup and Restore Workload Data</a><ul><li><a href=#backup-workload-data>Backup Workload Data</a></li><li><a href=#restore-workload-data>Restore Workload Data</a></li></ul></li><li><a href=#schedule-backup-and-restore-pvc>Schedule Backup and Restore PVC</a><ul><li><a href=#backup-pvc>Backup PVC</a></li><li><a href=#restore-pvc>Restore PVC</a></li></ul></li><li><a href=#schedule-backup-and-restore-database>Schedule Backup and Restore Database</a><ul><li><a href=#backup-database>Backup Database</a></li><li><a href=#restore-database>Restore Database</a></li></ul></li><li><a href=#schedule-backup-cluster-yamls>Schedule Backup Cluster YAMLs</a></li><li><a href=#trigger-backup-instantly>Trigger Backup Instantly</a></li><li><a href=#default-backup>Default Backup</a><ul><li><a href=#default-backup-of-workload-data>Default Backup of Workload Data</a></li><li><a href=#default-backup-of-a-pvc>Default Backup of a PVC</a></li><li><a href=#default-backup-of-database>Default Backup of Database</a></li></ul></li><li><a href=#auto-restore>Auto Restore</a></li><li><a href=#stash-clikubectl-plugin>Stash cli/kubectl-plugin</a></li><li><a href=#function>Function</a><ul><li></li></ul></li><li><a href=#stashpostrecovery>stashPostRecovery</a></li><li><a href=#task>Task</a><ul><li></li></ul></li></ul></nav></div></div></div></div></div><script>var kdDropdown=document.querySelector(".dropdown");var kdDropdownBtn=document.querySelector(".dropdown-trigger");kdDropdownBtn.addEventListener("click",function(){kdDropdown.classList.toggle("is-active");})</script></div><div class=overlay-bg></div><div class=sidebar-search-area><div class=search-area-top><h3>Search</h3><div class=searchbar-area><input type=search name=search id=searchbox placeholder=Search...>
<button onclick=queryPage(1)><i class="fa fa-search" aria-hidden=true></i></button></div><span id=searchbar-script-container style=display:none></span><div class="search-meta-information level"><div class=level-left></div></div></div><div class=search-result-wrapper></div><div class=pagination-area><div class=pagination-list></div></div></div><div class=improve-section-area><div class="container section"><div class=improve-bg-color><div class=columns><div class="column is-6"><a href=https://github.com/stashed/docs/edit/master/docs/design.md/>Improve This Page</a></div></div></div></div></div><script type=text/javascript>var pageSize=5;var acSearch=document.querySelector("#acSearch");var bodyOverlay=document.querySelector(".overlay-bg");var sidebarSearch=document.querySelector(".sidebar-search-area");acSearch.addEventListener("click",function(){bodyOverlay.style.display="block";sidebarSearch.style.right="0";document.getElementById("searchbox").focus();bodyOverlay.addEventListener("click",function(){bodyOverlay.style.display="none";sidebarSearch.style.right="-80%";});});function encodeQueryData(data){var ret=[];for(var d in data)
ret.push(encodeURIComponent(d)+'='+encodeURIComponent(data[d]));return ret.join('&');}
document.querySelector(".searchbar-area input[type=search]").addEventListener("keyup",function(event){event.preventDefault();if(event.keyCode===13){queryPage(1);}});function queryPage(idx){var q=document.getElementById("searchbox").value;var cx="015199383701854252104:0pfqfvpvwyl";var key="AIzaSyBo15AW3hatf4fO8actJUZ_d5qZJpx0rXM";var imgSize="small";var callback="renderResult";var src="https://www.googleapis.com/customsearch/v1?"+encodeQueryData({q:q,cx:cx,key:key,imgSize:imgSize,callback:callback,start:(idx-1)*pageSize+1,num:pageSize,});var newScript=document.createElement("script");newScript.src=src;e=document.getElementById("searchbar-script-container");var child=e.lastElementChild;if(child){e.removeChild(child);}
e.appendChild(newScript);}
function renderSearchResultEntry(e){var out='<div class="single-search-result">'+
'<h3><a href="'+e.link+'">'+e.title+'</a></h3>'+
'<a href="'+e.link+'">'+e.htmlFormattedUrl+'</a>'+
'<div class="result-description-wrapper">';if(e.pagemap&&e.pagemap.cse_thumbnail){out+='<div class="result-thumb">'+
'<img src="'+e.pagemap.cse_thumbnail[0].src+'" alt="" />'+
'</div>';}
out+='<div class="result-description">'+
'<p>'+
e.snippet+
'</p>'+
'</div>'+
'</div>'+
'</div>';return out;}
function renderResult(response){document.querySelector(".search-meta-information .level-left").innerHTML='<div class="level-left">'+
'<p>'+
'About <span class="search-count">'+response.searchInformation.formattedTotalResults+'</span> results (<span class="time-count">'+response.searchInformation.formattedSearchTime+' </span>seconds)'+
'</p>'+
'</div>';if(!response.items){return;}
var searchResultWrapper=document.querySelector(".search-result-wrapper");searchResultWrapper.innerHTML="";for(var i=0;i<response.items.length;i++){searchResultWrapper.innerHTML+=renderSearchResultEntry(response.items[i]);}
var pager='<ul>';if(response.queries.previousPage){var pageIndex=Math.floor(response.queries.previousPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Previous</a></li>';}
if(response.queries.request){var pageIndex=Math.floor(response.queries.request[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')" class="is-active">'+pageIndex+'</a></li>';}
if(response.queries.nextPage){var pageIndex=Math.floor(response.queries.nextPage[0].startIndex/pageSize)+1;pager+='<li><a href="#" onclick="queryPage('+pageIndex+')">Next</a></li>';}
pager+='</ul>';document.querySelector(".pagination-area .pagination-list").innerHTML=pager;}</script><section></section><section></section><section></section><button class=go-to-top id=goTop>
<i class="fa fa-angle-up" aria-hidden=true></i></button><footer class=footer-area><div class=footer-top><div class="container section"><div class="columns is-mobile is-multiline"><div class="column is-full-mobile is-one-third-desktop is-one-third-widescreen is-one-third-tablet" data-aos=fade-up><div class=single-footer-widget><div class=footer-logo><a href=https://appscode.com><img src=/assets/images/products/appscode/appscode.png alt=AppsCode class=img></a></div><div class=subscription-form><form action="https://appscode.us17.list-manage.com/subscribe/post?u=feb2bf31969a951e7449048a3&id=82fb19acb9" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=navbar-form target=_blank novalidate role=email role=email><label for=email>Subscribe to Our Newsletter</label><p class=spam-message>No spam, we promise. Your mail address is secure</p><div class="field has-addons"><div class=control><input class=input name=EMAIL id=mce-EMAIL type=email placeholder="Your work email address" required>
<button id=mc-embedded-subscribe type=submit name=subscribe class=button>
<i class="fa fa-paper-plane-o" aria-hidden=true></i></button></div></div></form></div><div class=contact-information><h4>Have any Inquiry?</h4><ul class=all-contact-info><li><a href=callto:+1%28650%29241-8486><span><i class="fa fa-phone" aria-hidden=true></i></span>+1(650)241-8486</a></li><li><a href=mailto:support@appscode.com><span><i class="fa fa-envelope-o" aria-hidden=true></i></span>support@appscode.com</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=500><div class=single-footer-widget><div class=footer-menu><h4>Products</h4><ul class=footer-link><li><a href=https://kubedb.com>KubeDB</a></li><li><a href=https://stash.run>Stash</a></li><li><a href=https://kubevault.com>KubeVault</a></li><li><a href>Voyager</a></li><li><a href=https://appscode.com/products/guard/>Guard</a></li><li><a href=https://pharmer.io>Pharmer</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=600><div class=single-footer-widget><div class=footer-menu><h4>Services</h4><ul class=footer-link><li><a href=https://appscode.com/pricing/>Pricing</a></li><li><a href=https://appscode.com/consulting/>Consulting</a></li><li><a href=https://appscode.com/training/>Training</a></li><li><a href=https://appscode.com/support/>Support</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=700><div class=single-footer-widget><div class=footer-menu><h4>Company</h4><ul class=footer-link><li><a href=https://appscode.com/about/>About Us</a></li><li><a href=https://blog.byte.builders>Blog</a></li><li><a href=https://appscode.com/contact/>Contact Us</a></li></ul></div></div></div><div class="column is-half-mobile" data-aos=fade-up data-aos-duration=800><div class=single-footer-widget><div class=footer-menu><h4>Legal</h4><ul class=footer-link><li><a href=https://appscode.com/legal/tos/>Terms of Sevice</a></li><li><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a></li><li><a href=https://appscode.com/legal/security/>Security</a></li><li><a href=https://appscode.com/legal/sla/>Service Level Agreement</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container section"><div class=columns><div class="column is-4"><p>© 2020 AppsCode Inc. All rights reserved.</p></div><div class="column is-4 is-mobile has-text-centered"><div class=footer-inline-link><a href=https://appscode.com/legal/privacy-policy/>Privacy Policy</a>
<a href=https://appscode.com/legal/tos/>Terms of Service</a></div></div><div class="column is-4 is-mobile has-text-right"><div class=socail-link-inline><ul><li><a href=https://twitter.com/AppsCodeHQ><i class="fa fa-twitter" aria-hidden=true></i></a></li><li><a href=https://www.facebook.com/appscode><i class="fa fa-facebook" aria-hidden=true></i></a></li><li><a href=https://www.youtube.com/c/AppsCodeInc><i class="fa fa-youtube" aria-hidden=true></i></a></li></ul></div></div></div></div></div></footer><script src=/assets/js/bulma-carousel.min.js></script><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script src=https://unpkg.com/downloadjs@1.4.7/download.min.js></script><script src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><script src=/assets/js/main.js></script><script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date();(function(){var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];s1.async=true;s1.src='https://embed.tawk.to/5821e34b18d9f16af02864b7/default';s1.charset='UTF-8';s1.setAttribute('crossorigin','*');s0.parentNode.insertBefore(s1,s0);})();</script></body></html>